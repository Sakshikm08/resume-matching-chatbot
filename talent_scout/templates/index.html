{% extends "base.html" %}
{% block content %}
<section class="hero">
  <div class="hero-text">
    <h1>Find the right talent with a single message.</h1>
    <p>Describe the skills and experience you need. The bot ranks your resumes and explains every match.</p>
  </div>
</section>

<section class="chat-panel">
  <form class="chat-form" method="post" action="/search">
    <label for="message">Describe your ideal candidate</label>
    <textarea id="message" name="message" rows="3"
      placeholder="Example: Need 3–5 years in Python, FastAPI, Docker and AWS, remote-friendly.">{{ query }}</textarea>
    <div class="form-row">
      <div>
        <label for="top_k">How many results?</label>
        <input type="number" id="top_k" name="top_k" value="5" min="1" max="20" />
      </div>
      <button type="submit" class="btn-primary">Search resumes</button>
    </div>
    {% if message %}
      <p class="status">{{ message }}</p>
    {% endif %}
  </form>
</section>

<section class="resume-upload-panel">
  <form method="post" action="/upload_resume" enctype="multipart/form-data" class="resume-upload-form">
    <h2>Add New Resume</h2>
    <div>
      <label for="candidate_name">Name:</label>
      <input type="text" id="candidate_name" name="candidate_name" required />
    </div>
    <div>
      <label for="title">Title:</label>
      <input type="text" id="title" name="title" />
    </div>
    <div>
      <label for="years_experience">Years of Experience:</label>
      <input type="number" id="years_experience" name="years_experience" min="0" step="0.5"/>
    </div>
    <div>
      <label for="location">Location:</label>
      <input type="text" id="location" name="location"/>
    </div>
    <div>
      <label for="skills">Skills (comma separated):</label>
      <input type="text" id="skills" name="skills" required />
    </div>
    <div>
      <label for="resume_file">Resume File (PDF or TXT):</label>
      <input type="file" id="resume_file" name="resume_file" accept=".pdf,.txt"/>
    </div>
    <button type="submit" class="btn-primary">Upload Resume</button>
  </form>
</section>


<section class="results">
  {% if results and results|length > 0 %}
    <h2>Top matches</h2>
    <div class="card-grid">
      {% for r in results %}
      <article class="card">
        <div class="card-header">
          <h3>{{ r.candidate_name }}</h3>
          <span class="title">{{ r.title or "Candidate" }}</span>
        </div>
        <div class="meta">
          {% if r.location %}
            <span class="meta-pill">{{ r.location }}</span>
          {% endif %}
          {% if r.years_experience %}
            <span class="meta-pill">{{ r.years_experience }} yrs</span>
          {% endif %}
        </div>

        <div class="score-row">
          <div class="score-label">Match score</div>
          <div class="score-bar">
            <!-- jinja variable below; VS Code error is ignorable -->
            <div class="score-bar-fill" style="width: {{ (r.match_score or 0)|float }}%;"></div>


          </div>
          <span class="score-value">{{ r.match_score }}%</span>
        </div>

        <div class="chips">
          {% for s in r.skills %}
            <span class="chip">{{ s.name }}</span>
          {% endfor %}
        </div>

        <p class="explanation">{{ r.explanation }}</p>
      </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="empty-state">No results yet. Describe the profile you are looking for and hit “Search resumes”.</p>
  {% endif %}
</section>
{% endblock %}
